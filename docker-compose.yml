#somente backend & db
services:
  mariadb:
    image: mariadb:11
    container_name: mariadb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: deslocafacil
    volumes:
      - db_data:/var/lib/mysql
      
  backend:
    build: ./backend
    container_name: deslocafacil-backend
    ports:
      - "8080:8080"
    depends_on:
      - mariadb   # garante que o container do banco sobe antes
     
    environment:
      # Variáveis sensíveis vindas do SSM (o user-data exporta antes de rodar o compose)
      DB_USER: "${DB_USER}"
      DB_PASSWORD: "${DB_PASSWORD}"
      DB_URL: "${DB_URL}"
      FLYWAY_URL: "${FLYWAY_URL}"
      FLYWAY_USER: "${FLYWAY_USER}"
      FLYWAY_PASSWORD: "${FLYWAY_PASSWORD}"

      # Caminho das chaves (se o backend estiver configurado para usar TLS com PEM)
      TLS_KEY_PATH: "/app/ssl/key.pem"
      TLS_CERT_PATH: "/app/ssl/cert.pem"

    restart: unless-stopped
